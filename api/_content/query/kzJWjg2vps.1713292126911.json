{"_path":"/concurrency/javascript/event-loop","_dir":"javascript","_draft":false,"_partial":false,"_locale":"","title":" Event Loop","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"event-loop"},"children":[{"type":"text","value":"Event Loop"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First we need to understand"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Call Stack"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Web APIs (Browser) <-> C++ APIs (Node)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Callback Queue\n"},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Micro Task Queue"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Macro Task Queue"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Event Loop"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Job of event loop is very simple:"}]}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"if (stack.isEmpty) {\n  if (!queue.isEmpty) {\n    const item = queue.shift()\n    stack.push(item)\n  }\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"if (stack.isEmpty) {\n  if (!queue.isEmpty) {\n    const item = queue.shift()\n    stack.push(item)\n  }\n}\n"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Shouldn't block the event loop -> don't put blocking code on stack"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"just spins round and round in a cpu efficient manner"}]}]},{"type":"element","tag":"h3","props":{"id":"working"},"children":[{"type":"text","value":"Working:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When we queue a task, event loop takes a detour"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Tasks are added to queue, event loop picks a task, waits for it to finish, then picks a new task"}]}]},{"type":"element","tag":"h4","props":{"id":"render-steps"},"children":[{"type":"text","value":"Render Steps:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"to update what is on the screen"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"style calculation (CSS)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Layout - create render tree"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"actual pixel data - painting"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"if you want to do something before browser paints - "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"requestAnimationFrame"}]}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"requestAnimationFrame(() => {\n  console.log('do after 1st animation')\n})\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestAnimationFrame(() => {\n  console.log('do after 1st animation')\n})\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"if you want to do something after browser paints - nested use of "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"requestAnimationFrame"}]}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"requestAnimationFrame(() => {\n  requestAnimationFrame(() => {\n    console.log('do after 1st animation')\n  })\n})\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"requestAnimationFrame(() => {\n  requestAnimationFrame(() => {\n    console.log('do after 1st animation')\n  })\n})\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"event-loop","depth":2,"text":"Event Loop","children":[{"id":"working","depth":3,"text":"Working:"}]}]}},"_type":"markdown","_id":"content:concurrency:javascript:4. Event Loop.md","_source":"content","_file":"concurrency/javascript/4. Event Loop.md","_extension":"md"}